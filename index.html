<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIthika Samadith | Advanced 3D Portfolio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            overflow: hidden;
            background: #0a0a1a;
            color: #fff;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        .ui-element {
            position: absolute;
            background: rgba(10, 10, 26, 0.85);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            pointer-events: all;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.15);
            overflow: hidden;
        }

        .ui-element::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
        }

        #welcome-panel {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            text-align: center;
            z-index: 10;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
            50% { transform: translate(-50%, -50%) translateY(-10px); }
        }

        #navigation {
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            padding: 20px 30px;
        }

        .nav-btn {
            background: linear-gradient(135deg, rgba(30, 30, 60, 0.9) 0%, rgba(20, 20, 40, 0.9) 100%);
            color: #fff;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.7s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn:hover {
            background: linear-gradient(135deg, rgba(80, 100, 255, 0.9) 0%, rgba(106, 17, 203, 0.9) 100%);
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(106, 17, 203, 0.4);
        }

        #info-panel {
            top: 40px;
            right: 40px;
            width: 380px;
            max-height: 80vh;
            overflow-y: auto;
            opacity: 0;
            transform: translateX(20px);
            pointer-events: none;
        }

        #info-panel.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }

        #info-panel::-webkit-scrollbar {
            width: 8px;
        }

        #info-panel::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        #info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 10px;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 15px rgba(106, 17, 203, 0.3);
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #a0a0ff;
            position: relative;
            display: inline-block;
        }

        h2::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 3px;
        }

        p {
            line-height: 1.7;
            margin-bottom: 20px;
            color: #d0d0ff;
            font-size: 16px;
        }

        .highlight {
            color: #6a11cb;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(106, 17, 203, 0.5);
        }

        .skill-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 20px 0;
        }

        .skill-tag {
            background: linear-gradient(135deg, rgba(80, 100, 255, 0.25) 0%, rgba(106, 17, 203, 0.25) 100%);
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .skill-tag:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.3);
        }

        .project-card {
            background: linear-gradient(135deg, rgba(30, 30, 60, 0.6) 0%, rgba(20, 20, 40, 0.6) 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            transition: all 0.4s ease;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .project-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(180deg, #6a11cb 0%, #2575fc 100%);
        }

        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, rgba(80, 100, 255, 0.3) 0%, rgba(106, 17, 203, 0.3) 100%);
        }

        .project-card h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #a0a0ff;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a1a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 1s ease;
        }

        .loader {
            width: 70px;
            height: 70px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid #6a11cb;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 25px;
            position: relative;
        }

        .loader::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 5px solid transparent;
            border-top: 5px solid #2575fc;
            border-radius: 50%;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .fade-out {
            opacity: 0;
        }

        #contact-info {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 25px 0;
        }

        .contact-icon {
            font-size: 28px;
            color: #a0a0ff;
            transition: all 0.4s ease;
            background: rgba(255,255,255,0.05);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .contact-icon:hover {
            color: #6a11cb;
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 10px 20px rgba(106, 17, 203, 0.3);
            background: rgba(255,255,255,0.1);
        }

        .floating-notification {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 10, 26, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 5;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        .floating-notification.show {
            opacity: 1;
        }

        /* Progress bars */
        .skill-progress {
            margin: 15px 0;
        }

        .skill-name {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 4px;
            width: 0;
            transition: width 1s ease;
        }

        /* Asset loading progress */
        #loading-progress {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        #loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Particle selector */
        #particle-selector {
            position: fixed;
            bottom: 40px;
            right: 40px;
            display: flex;
            gap: 15px;
            z-index: 5;
        }

        .particle-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .particle-btn:hover {
            transform: scale(1.1);
        }

        .particle-btn.active {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            #welcome-panel {
                width: 90%;
                padding: 20px;
            }
            
            #navigation {
                flex-wrap: wrap;
                justify-content: center;
                bottom: 20px;
            }
            
            #info-panel {
                width: 90%;
                right: 5%;
                left: 5%;
                top: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .nav-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            #particle-selector {
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="loader"></div>
        <h2>Loading 3D Environment...</h2>
        <div id="loading-progress">
            <div id="loading-progress-bar"></div>
        </div>
        <p id="loading-text">Initializing scene</p>
    </div>

    <div id="canvas-container"></div>

    <div class="floating-notification" id="interaction-notification">
        Click on objects to interact with them
    </div>

    <div id="particle-selector" class="hidden">
        <button class="particle-btn" data-particle="stars" style="background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);"></button>
        <button class="particle-btn" data-particle="bubbles" style="background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);"></button>
        <button class="particle-btn" data-particle="fireflies" style="background: linear-gradient(135deg, #69f0ae 0%, #00e5ff 100%);"></button>
    </div>

    <div id="ui-container">
        <div id="welcome-panel" class="ui-element">
            <h1>SIthika Samadith</h1>
            <h2>Full Stack Web Developer</h2>
            <p>Welcome to my immersive 3D portfolio. Explore my skills, projects, and experience in this interactive environment.</p>
            <div class="skill-tags">
                <span class="skill-tag">JavaScript</span>
                <span class="skill-tag">React</span>
                <span class="skill-tag">Node.js</span>
                <span class="skill-tag">Three.js</span>
                <span class="skill-tag">MongoDB</span>
                <span class="skill-tag">Express</span>
                <span class="skill-tag">WebGL</span>
                <span class="skill-tag">AWS</span>
            </div>
            <button id="start-btn" class="nav-btn">
                <i class="fas fa-play"></i> Enter Portfolio
            </button>
        </div>

        <div id="navigation" class="ui-element hidden">
            <button class="nav-btn" data-section="about">
                <i class="fas fa-user"></i> About
            </button>
            <button class="nav-btn" data-section="skills">
                <i class="fas fa-code"></i> Skills
            </button>
            <button class="nav-btn" data-section="projects">
                <i class="fas fa-briefcase"></i> Projects
            </button>
            <button class="nav-btn" data-section="contact">
                <i class="fas fa-envelope"></i> Contact
            </button>
        </div>

        <div id="info-panel" class="ui-element">
            <button class="close-btn">
                <i class="fas fa-times"></i>
            </button>
            <div id="info-content"></div>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let experienceStarted = false;
        let roomObjects = {};
        let models = {};
        let assetLoader;
        let particleSystem = null;
        let currentParticleType = 'stars';
        let raycaster, mouse;
        let clock = new THREE.Clock();
        let mixers = [];

        // Initialize everything when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded - initializing portfolio');
            initializeScene();
            setupEventListeners();
        });

        function initializeScene() {
            try {
                // Create scene
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x0a0a1a);
                scene.fog = new THREE.Fog(0x0a0a1a, 15, 50);

                // Create camera
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 8, 15);

                // Create renderer
                renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                renderer.outputEncoding = THREE.sRGBEncoding;
                document.getElementById('canvas-container').appendChild(renderer.domElement);

                // Add orbit controls
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.minDistance = 5;
                controls.maxDistance = 25;
                controls.maxPolarAngle = Math.PI / 2 - 0.1;

                // Initialize raycaster and mouse
                raycaster = new THREE.Raycaster();
                mouse = new THREE.Vector2();

                // Initialize asset loader
                initializeAssetLoader();

                // Create lighting
                setupLighting();

                // Create room and load 3D models
                createRoom();
                load3DAssets();

                // Start animation loop
                animate();

            } catch (error) {
                console.error('Error initializing scene:', error);
                document.getElementById('loading-screen').innerHTML = `
                    <h2>Error Loading 3D Environment</h2>
                    <p>But you can still explore my portfolio</p>
                    <button onclick="startExperience()" class="nav-btn" style="margin-top: 20px;">
                        <i class="fas fa-play"></i> Continue to Portfolio
                    </button>
                `;
            }
        }

        function initializeAssetLoader() {
            // Set up GLTF Loader
            const gltfLoader = new THREE.GLTFLoader();
            
            // Add DRACO loader for compressed models
            const dracoLoader = new THREE.DRACOLoader();
            dracoLoader.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.5.5/');
            gltfLoader.setDRACOLoader(dracoLoader);

            assetLoader = gltfLoader;
        }

        function load3DAssets() {
            // Using free, open-source 3D models from various sources
            const assetsToLoad = [
                {
                    name: 'computer',
                    url: 'https://threejs.org/examples/models/gltf/LittlestTokyo.glb',
                    position: { x: 8, y: 0, z: -8 },
                    scale: { x: 0.02, y: 0.02, z: 0.02 },
                    rotation: { y: -Math.PI / 6 }
                },
                {
                    name: 'bookshelf',
                    url: 'https://threejs.org/examples/models/gltf/DamagedHelmet/glTF/DamagedHelmet.gltf',
                    position: { x: -10, y: 4, z: -10 },
                    scale: { x: 2, y: 2, z: 2 },
                    rotation: { y: Math.PI / 4 }
                },
                {
                    name: 'plant',
                    url: 'https://threejs.org/examples/models/gltf/FlightHelmet/glTF/FlightHelmet.gltf',
                    position: { x: -5, y: 2, z: -12 },
                    scale: { x: 1.5, y: 1.5, z: 1.5 },
                    rotation: { y: -Math.PI / 3 }
                },
                {
                    name: 'robot',
                    url: 'https://threejs.org/examples/models/gltf/RobotExpressive/RobotExpressive.glb',
                    position: { x: 0, y: 0, z: 5 },
                    scale: { x: 2, y: 2, z: 2 },
                    rotation: { y: Math.PI }
                },
                {
                    name: 'trophy',
                    url: 'https://threejs.org/examples/models/gltf/SciFiHelmet/glTF/SciFiHelmet.gltf',
                    position: { x: 10, y: 3, z: 5 },
                    scale: { x: 3, y: 3, z: 3 }
                }
            ];

            let loadedCount = 0;
            const totalAssets = assetsToLoad.length;

            assetsToLoad.forEach(asset => {
                loadModel(asset, () => {
                    loadedCount++;
                    const progress = Math.round((loadedCount / totalAssets) * 100);
                    document.getElementById('loading-progress-bar').style.width = `${progress}%`;
                    document.getElementById('loading-text').textContent = 
                        `Loading 3D models... ${progress}%`;
                    
                    if (loadedCount === totalAssets) {
                        // All models loaded
                        setTimeout(() => {
                            document.getElementById('loading-screen').classList.add('fade-out');
                            setTimeout(() => {
                                document.getElementById('loading-screen').classList.add('hidden');
                            }, 1000);
                        }, 500);
                    }
                });
            });
        }

        function loadModel(assetConfig, onLoadCallback) {
            assetLoader.load(
                assetConfig.url,
                (gltf) => {
                    const model = gltf.scene;
                    model.name = assetConfig.name;
                    
                    // Position and scale the model
                    model.position.set(
                        assetConfig.position.x,
                        assetConfig.position.y,
                        assetConfig.position.z
                    );
                    
                    if (assetConfig.scale) {
                        model.scale.set(
                            assetConfig.scale.x,
                            assetConfig.scale.y,
                            assetConfig.scale.z
                        );
                    }
                    
                    if (assetConfig.rotation) {
                        model.rotation.set(
                            assetConfig.rotation.x || 0,
                            assetConfig.rotation.y || 0,
                            assetConfig.rotation.z || 0
                        );
                    }
                    
                    // Enable shadows and improve material quality
                    model.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            
                            // Improve material rendering
                            if (child.material) {
                                child.material.metalness = 0.1;
                                child.material.roughness = 0.5;
                                child.material.envMapIntensity = 1;
                            }
                        }
                    });
                    
                    scene.add(model);
                    roomObjects[assetConfig.name] = model;
                    models[assetConfig.name] = model;
                    
                    // Handle animations if present
                    if (gltf.animations && gltf.animations.length > 0) {
                        const mixer = new THREE.AnimationMixer(model);
                        mixers.push(mixer);
                        
                        // Play all animations
                        gltf.animations.forEach((clip) => {
                            const action = mixer.clipAction(clip);
                            action.play();
                        });
                    }
                    
                    console.log(`Loaded: ${assetConfig.name}`);
                    onLoadCallback();
                },
                (progress) => {
                    // Progress callback
                    const percent = progress.loaded / progress.total * 100;
                    console.log(`Loading ${assetConfig.name}: ${percent}%`);
                },
                (error) => {
                    console.error(`Error loading ${assetConfig.name}:`, error);
                    // Create a fallback primitive if model fails to load
                    createFallbackObject(assetConfig);
                    onLoadCallback();
                }
            );
        }

        function createFallbackObject(assetConfig) {
            let geometry, material;
            
            switch(assetConfig.name) {
                case 'computer':
                    geometry = new THREE.BoxGeometry(2, 1.5, 0.3);
                    material = new THREE.MeshStandardMaterial({ color: 0x333333 });
                    break;
                case 'bookshelf':
                    geometry = new THREE.BoxGeometry(3, 4, 1);
                    material = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
                    break;
                case 'plant':
                    geometry = new THREE.ConeGeometry(0.5, 2, 8);
                    material = new THREE.MeshStandardMaterial({ color: 0x228B22 });
                    break;
                case 'robot':
                    geometry = new THREE.CylinderGeometry(0.5, 0.5, 2, 8);
                    material = new THREE.MeshStandardMaterial({ color: 0x444444 });
                    break;
                case 'trophy':
                    geometry = new THREE.ConeGeometry(0.5, 1.5, 8);
                    material = new THREE.MeshStandardMaterial({ color: 0xFFD700 });
                    break;
                default:
                    geometry = new THREE.BoxGeometry(1, 1, 1);
                    material = new THREE.MeshStandardMaterial({ color: 0x666666 });
            }
            
            const fallbackObject = new THREE.Mesh(geometry, material);
            fallbackObject.name = assetConfig.name;
            fallbackObject.position.set(
                assetConfig.position.x,
                assetConfig.position.y,
                assetConfig.position.z
            );
            
            if (assetConfig.scale) {
                fallbackObject.scale.set(
                    assetConfig.scale.x,
                    assetConfig.scale.y,
                    assetConfig.scale.z
                );
            }
            
            fallbackObject.castShadow = true;
            fallbackObject.receiveShadow = true;
            
            scene.add(fallbackObject);
            roomObjects[assetConfig.name] = fallbackObject;
            models[assetConfig.name] = fallbackObject;
            
            console.log(`Created fallback for: ${assetConfig.name}`);
        }

        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);

            // Main directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 20, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 1024;
            directionalLight.shadow.mapSize.height = 1024;
            scene.add(directionalLight);

            // Colored point lights for ambiance
            const pointLight1 = new THREE.PointLight(0x6a11cb, 0.8, 20);
            pointLight1.position.set(5, 8, 5);
            scene.add(pointLight1);

            const pointLight2 = new THREE.PointLight(0x2575fc, 0.6, 20);
            pointLight2.position.set(-5, 6, -5);
            scene.add(pointLight2);
            
            // Add a spotlight for dramatic effect
            const spotLight = new THREE.SpotLight(0xffffff, 0.5);
            spotLight.position.set(0, 15, 0);
            spotLight.angle = Math.PI / 6;
            spotLight.penumbra = 0.1;
            spotLight.decay = 2;
            spotLight.distance = 50;
            spotLight.castShadow = true;
            scene.add(spotLight);
        }

        function createRoom() {
            // Floor
            const floorGeometry = new THREE.PlaneGeometry(40, 40);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x1a1a2e,
                roughness: 0.8,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Add grid helper
            const gridHelper = new THREE.GridHelper(40, 20, 0x0a0a1a, 0x0a0a1a);
            gridHelper.position.y = 0.01;
            scene.add(gridHelper);

            // Walls
            const wallGeometry = new THREE.BoxGeometry(40, 15, 0.5);
            const wallMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x16213e,
                roughness: 0.7,
                metalness: 0.1
            });

            // Back wall
            const backWall = new THREE.Mesh(wallGeometry, wallMaterial);
            backWall.position.set(0, 7.5, -20);
            backWall.receiveShadow = true;
            scene.add(backWall);

            // Left wall
            const leftWall = new THREE.Mesh(wallGeometry, wallMaterial);
            leftWall.rotation.y = Math.PI / 2;
            leftWall.position.set(-20, 7.5, 0);
            leftWall.receiveShadow = true;
            scene.add(leftWall);

            // Right wall
            const rightWall = new THREE.Mesh(wallGeometry, wallMaterial);
            rightWall.rotation.y = Math.PI / 2;
            rightWall.position.set(20, 7.5, 0);
            rightWall.receiveShadow = true;
            scene.add(rightWall);

            // Ceiling
            const ceilingGeometry = new THREE.PlaneGeometry(40, 40);
            const ceilingMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x0f3460,
                roughness: 0.9,
                metalness: 0.1
            });
            const ceiling = new THREE.Mesh(ceilingGeometry, ceilingMaterial);
            ceiling.rotation.x = Math.PI / 2;
            ceiling.position.y = 15;
            ceiling.receiveShadow = true;
            scene.add(ceiling);
        }
        
        function createParticleSystem(type) {
            // Remove existing particle system
            if (particleSystem) {
                scene.remove(particleSystem);
                particleSystem.geometry.dispose();
                particleSystem.material.dispose();
            }
            
            const particleCount = 1000;
            const particles = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);
            const sizes = new Float32Array(particleCount);
            
            const color = new THREE.Color();
            
            for (let i = 0; i < particleCount; i++) {
                // Positions
                positions[i * 3] = (Math.random() - 0.5) * 50;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 30;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 50;
                
                // Colors based on type
                if (type === 'stars') {
                    color.setHSL(0.6, 0.8, 0.5 + Math.random() * 0.5);
                } else if (type === 'bubbles') {
                    color.setHSL(0.1, 0.8, 0.5 + Math.random() * 0.5);
                } else if (type === 'fireflies') {
                    color.setHSL(0.3, 0.8, 0.5 + Math.random() * 0.5);
                }
                
                colors[i * 3] = color.r;
                colors[i * 3 + 1] = color.g;
                colors[i * 3 + 2] = color.b;
                
                // Sizes
                sizes[i] = Math.random() * 5;
            }
            
            particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            particles.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            particles.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
            
            let particleMaterial;
            if (type === 'stars') {
                particleMaterial = new THREE.PointsMaterial({
                    size: 0.1,
                    sizeAttenuation: true,
                    vertexColors: true,
                    transparent: true,
                    opacity: 0.8
                });
            } else if (type === 'bubbles') {
                particleMaterial = new THREE.PointsMaterial({
                    size: 0.3,
                    sizeAttenuation: true,
                    vertexColors: true,
                    transparent: true,
                    opacity: 0.6,
                    blending: THREE.AdditiveBlending
                });
            } else if (type === 'fireflies') {
                particleMaterial = new THREE.PointsMaterial({
                    size: 0.2,
                    sizeAttenuation: true,
                    vertexColors: true,
                    transparent: true,
                    opacity: 0.8,
                    blending: THREE.AdditiveBlending
                });
            }
            
            particleSystem = new THREE.Points(particles, particleMaterial);
            scene.add(particleSystem);
        }

        function setupEventListeners() {
            // Start button
            document.getElementById('start-btn').addEventListener('click', startExperience);
            
            // Navigation buttons
            document.querySelectorAll('.nav-btn[data-section]').forEach(btn => {
                btn.addEventListener('click', function() {
                    showInfo(this.getAttribute('data-section'));
                });
            });
            
            // Close button
            document.querySelector('.close-btn').addEventListener('click', hideInfo);
            
            // Window resize
            window.addEventListener('resize', onWindowResize);
            
            // Canvas click for 3D objects
            if (renderer) {
                renderer.domElement.addEventListener('click', onCanvasClick);
            }
            
            // Particle selector buttons
            document.querySelectorAll('.particle-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.particle-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentParticleType = this.getAttribute('data-particle');
                    createParticleSystem(currentParticleType);
                });
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', onKeyDown);
        }

        function onWindowResize() {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }

        function onKeyDown(event) {
            if (!experienceStarted) return;
            
            switch(event.key) {
                case '1':
                    showInfo('about');
                    break;
                case '2':
                    showInfo('skills');
                    break;
                case '3':
                    showInfo('projects');
                    break;
                case '4':
                    showInfo('contact');
                    break;
                case 'Escape':
                    hideInfo();
                    break;
            }
        }

        function onCanvasClick(event) {
            if (!experienceStarted || !renderer) return;

            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(scene.children, true);

            if (intersects.length > 0) {
                let object = intersects[0].object;
                // Traverse up to find the parent group
                while (object.parent && object.parent !== scene) {
                    object = object.parent;
                }
                
                if (object.name === "computer") {
                    showInfo('projects');
                    animateComputer();
                } else if (object.name === "bookshelf") {
                    showInfo('skills');
                    animateBookshelf();
                } else if (object.name === "plant") {
                    showInfo('about');
                    animatePlant();
                } else if (object.name === "robot") {
                    animateRobot();
                    showInfo('about');
                } else if (object.name === "trophy") {
                    animateTrophy();
                    showInfo('skills');
                }
            }
        }

        function animateComputer() {
            if (roomObjects.computer) {
                gsap.to(roomObjects.computer.rotation, {
                    y: roomObjects.computer.rotation.y + Math.PI / 12,
                    duration: 0.5,
                    ease: "power2.out"
                });
                
                // Add a glowing effect
                gsap.to(roomObjects.computer.scale, {
                    x: 1.1,
                    y: 1.1,
                    z: 1.1,
                    duration: 0.3,
                    yoyo: true,
                    repeat: 1
                });
            }
        }

        function animateBookshelf() {
            if (roomObjects.bookshelf) {
                gsap.to(roomObjects.bookshelf.position, {
                    y: roomObjects.bookshelf.position.y + 0.5,
                    duration: 0.3,
                    yoyo: true,
                    repeat: 1
                });
            }
        }

        function animatePlant() {
            if (roomObjects.plant) {
                gsap.to(roomObjects.plant.scale, {
                    x: 1.1,
                    y: 1.1,
                    z: 1.1,
                    duration: 0.3,
                    yoyo: true,
                    repeat: 1
                });
            }
        }
        
        function animateRobot() {
            if (roomObjects.robot) {
                gsap.to(roomObjects.robot.rotation, {
                    y: roomObjects.robot.rotation.y + Math.PI * 2,
                    duration: 2,
                    ease: "power2.out"
                });
                
                gsap.to(roomObjects.robot.position, {
                    y: roomObjects.robot.position.y + 1,
                    duration: 1,
                    yoyo: true,
                    repeat: 1,
                    ease: "power1.inOut"
                });
            }
        }
        
        function animateTrophy() {
            if (roomObjects.trophy) {
                gsap.to(roomObjects.trophy.scale, {
                    x: 1.5,
                    y: 1.5,
                    z: 1.5,
                    duration: 0.5,
                    yoyo: true,
                    repeat: 1
                });
                
                gsap.to(roomObjects.trophy.rotation, {
                    y: roomObjects.trophy.rotation.y + Math.PI * 2,
                    duration: 1,
                    ease: "power2.out"
                });
            }
        }

        function animate() {
            if (scene && camera && renderer) {
                requestAnimationFrame(animate);
                
                const delta = clock.getDelta();
                
                // Update animation mixers
                mixers.forEach(mixer => {
                    mixer.update(delta);
                });
                
                // Rotate models slowly
                if (models.bookshelf) {
                    models.bookshelf.rotation.y += 0.005;
                }
                
                if (models.trophy) {
                    models.trophy.rotation.y += 0.01;
                }
                
                // Animate particles
                if (particleSystem) {
                    const positions = particleSystem.geometry.attributes.position.array;
                    const time = Date.now() * 0.0005;
                    
                    for (let i = 0; i < positions.length; i += 3) {
                        if (currentParticleType === 'stars') {
                            // Stars move slowly
                            positions[i + 1] += Math.sin(time + i) * 0.001;
                        } else if (currentParticleType === 'bubbles') {
                            // Bubbles float up
                            positions[i + 1] += 0.01;
                            if (positions[i + 1] > 15) positions[i + 1] = -15;
                        } else if (currentParticleType === 'fireflies') {
                            // Fireflies move randomly
                            positions[i] += (Math.random() - 0.5) * 0.02;
                            positions[i + 1] += (Math.random() - 0.5) * 0.02;
                            positions[i + 2] += (Math.random() - 0.5) * 0.02;
                        }
                    }
                    
                    particleSystem.geometry.attributes.position.needsUpdate = true;
                }
                
                controls.update();
                renderer.render(scene, camera);
            }
        }

        // UI Functions
        function startExperience() {
            console.log('Start Experience clicked!');
            experienceStarted = true;
            
            // Hide welcome panel with animation
            gsap.to("#welcome-panel", {
                opacity: 0,
                scale: 0.8,
                duration: 0.8,
                ease: "power2.in",
                onComplete: function() {
                    document.getElementById('welcome-panel').classList.add('hidden');
                }
            });
            
            // Show navigation with animation
            document.getElementById('navigation').classList.remove('hidden');
            gsap.from("#navigation", {
                opacity: 0,
                y: 50,
                duration: 1,
                ease: "power2.out",
                delay: 0.5
            });
            
            // Show particle selector
            document.getElementById('particle-selector').classList.remove('hidden');
            gsap.from("#particle-selector", {
                opacity: 0,
                x: 50,
                duration: 1,
                ease: "power2.out",
                delay: 0.7
            });
            
            // Show interaction notification
            const notification = document.getElementById('interaction-notification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
            
            // Animate camera to a better position
            if (typeof gsap !== 'undefined' && camera) {
                gsap.to(camera.position, {
                    x: 5,
                    y: 6,
                    z: 12,
                    duration: 2,
                    ease: "power2.inOut"
                });
            }
            
            // Create particle system after experience starts
            createParticleSystem(currentParticleType);
        }

        function showInfo(type) {
            console.log('Showing info:', type);
            const infoPanel = document.getElementById('info-panel');
            const infoContent = document.getElementById('info-content');
            
            let content = '';
            switch(type) {
                case 'about':
                    content = `
                        <h2>About Me</h2>
                        <p>Hello! I'm <span class="highlight">SIthika Samadith</span>, a passionate full-stack web developer with over 5 years of experience creating dynamic, responsive web applications.</p>
                        <p>I specialize in modern JavaScript frameworks, cloud technologies, and creating immersive user experiences.</p>
                        <p>When I'm not coding, you can find me exploring new technologies, contributing to open-source projects, or enjoying outdoor activities.</p>
                        <div class="skill-tags">
                            <span class="skill-tag">Full-Stack Development</span>
                            <span class="skill-tag">Cloud Architecture</span>
                            <span class="skill-tag">UI/UX Design</span>
                        </div>
                    `;
                    break;
                case 'skills':
                    content = `
                        <h2>My Skills</h2>
                        <p>I have extensive experience with modern web technologies and frameworks:</p>
                        <div class="skill-tags">
                            <span class="skill-tag">JavaScript/ES6+</span>
                            <span class="skill-tag">TypeScript</span>
                            <span class="skill-tag">React</span>
                            <span class="skill-tag">Vue.js</span>
                            <span class="skill-tag">Node.js</span>
                            <span class="skill-tag">Express</span>
                            <span class="skill-tag">Three.js</span>
                            <span class="skill-tag">MongoDB</span>
                            <span class="skill-tag">PostgreSQL</span>
                            <span class="skill-tag">AWS</span>
                            <span class="skill-tag">Docker</span>
                            <span class="skill-tag">Git</span>
                        </div>
                        <div class="skill-progress">
                            <div class="skill-name">
                                <span>Frontend Development</span>
                                <span>95%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 95%"></div>
                            </div>
                        </div>
                        <div class="skill-progress">
                            <div class="skill-name">
                                <span>Backend Development</span>
                                <span>90%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 90%"></div>
                            </div>
                        </div>
                        <div class="skill-progress">
                            <div class="skill-name">
                                <span>UI/UX Design</span>
                                <span>85%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 85%"></div>
                            </div>
                        </div>
                    `;
                    break;
                case 'projects':
                    content = `
                        <h2>My Projects</h2>
                        <div class="project-card">
                            <h3>E-Commerce Platform</h3>
                            <p>A full-stack e-commerce solution with React frontend, Node.js backend, and MongoDB database.</p>
                            <div class="skill-tags">
                                <span class="skill-tag">React</span>
                                <span class="skill-tag">Node.js</span>
                                <span class="skill-tag">MongoDB</span>
                            </div>
                        </div>
                        <div class="project-card">
                            <h3>Task Management App</h3>
                            <p>A collaborative task management application with real-time updates using Socket.io.</p>
                            <div class="skill-tags">
                                <span class="skill-tag">Vue.js</span>
                                <span class="skill-tag">Express</span>
                                <span class="skill-tag">Socket.io</span>
                            </div>
                        </div>
                        <div class="project-card">
                            <h3>Data Visualization Dashboard</h3>
                            <p>An interactive dashboard for visualizing complex datasets with D3.js and Three.js.</p>
                            <div class="skill-tags">
                                <span class="skill-tag">D3.js</span>
                                <span class="skill-tag">Three.js</span>
                                <span class="skill-tag">React</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'contact':
                    content = `
                        <h2>Get In Touch</h2>
                        <p>I'm always interested in new opportunities and collaborations!</p>
                        <div id="contact-info">
                            <a href="mailto:sithika.samadith@example.com" class="contact-icon">
                                <i class="fas fa-envelope"></i>
                            </a>
                            <a href="https://linkedin.com/in/sithika" class="contact-icon">
                                <i class="fab fa-linkedin"></i>
                            </a>
                            <a href="https://github.com/sithika" class="contact-icon">
                                <i class="fab fa-github"></i>
                            </a>
                        </div>
                        <p><i class="fas fa-envelope"></i> Email: sithika.samadith@example.com</p>
                        <p><i class="fas fa-phone"></i> Phone: +1 (555) 123-4567</p>
                    `;
                    break;
            }
            
            infoContent.innerHTML = content;
            infoPanel.classList.add('active');
            
            // Animate progress bars
            setTimeout(() => {
                document.querySelectorAll('.progress-fill').forEach(bar => {
                    bar.style.width = bar.style.width;
                });
            }, 100);
        }

        function hideInfo() {
            document.getElementById('info-panel').classList.remove('active');
        }

        // Make functions globally available
        window.startExperience = startExperience;
        window.showInfo = showInfo;
        window.hideInfo = hideInfo;
    </script>
</body>
</html>